(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[10],{bb55:function(e,s,t){"use strict";t.r(s);var o=function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("q-page",{attrs:{padding:""}},[t("div",{staticClass:"text-h4 text-center q-mx-md"},[e._v("Выбор платформы для проведения занятий")]),e.$q.sessionStorage.getItem("is_teacher")?t("div",[t("div",{staticClass:"row justify-center q-my-md q-ml-md"},[t("div",{staticClass:"col-md-6"},[t("q-card",{staticClass:"g-ma-md",attrs:{flat:"",bordered:""}},[t("q-card-section",[t("q-card-section",[e._v("\n              Выбранная платформа по умолчанию\n              "),t("q-select",{attrs:{label:"Выберите платформу",options:e.platforms,"emit-value":"","map-options":""},on:{input:e.sendUpdatedPreferences},model:{value:e.prefs["default_platform"],callback:function(s){e.$set(e.prefs,"default_platform",s)},expression:"prefs['default_platform']"}})],1)],1)],1)],1)]),t("q-separator"),e.sync_error?t("q-banner",{staticClass:"bg-orange text-white q-ma-md",scopedSlots:e._u([{key:"avatar",fn:function(){return[t("q-icon",{attrs:{name:"warning"}})]},proxy:!0}],null,!1,1106460047)},[e._v("\n      Не удалось синхронизировать расписание. Список дисциплин и типов занятий может быть неполным.\n    ")]):e._e(),t("div",{staticClass:"row items-start justify-center q-pa-md q-gutter-md"},[t("div",{staticClass:"col-md-6 q-gutter-md"},e._l(e.disciplines,(function(s,o){return t("q-card",{key:o,staticClass:"q-g"},[t("q-card-section",{staticClass:"bg-primary text-white"},[t("div",{staticClass:"text-h6"},[e._v(e._s(s["discipline_name"]))])]),e._l(s["lesson_types"],(function(s,a){return t("q-card-section",{key:a},[t("q-form",[null!=s["kind_of_work"]?t("span",{staticClass:"text-subtitle1"},[e._v("\n                      "+e._s(s["kind_of_work"])+"\n                      "),t("q-tooltip",{attrs:{anchor:"center right",self:"center left"}},[e._v("Тип занятия")])],1):e._e(),t("q-select",{attrs:{label:"Выберите платформу",options:e.platforms,"emit-value":"","map-options":""},on:{input:e.sendUpdatedPreferences},model:{value:e.disciplines[o]["lesson_types"][a].platform,callback:function(s){e.$set(e.disciplines[o]["lesson_types"][a],"platform",s)},expression:"disciplines[oid]['lesson_types'][kow_oid].platform"}})],1)],1)})),t("q-card-section")],2)})),1)])],1):e._e(),e.$q.sessionStorage.getItem("is_student")?t("div",{staticClass:"q-mt-xl text-center"},[t("q-icon",{attrs:{name:"highlight_off",size:"xl",color:"red"}}),t("div",{staticClass:"text-h6"},[e._v("\n      Сервис доступен только для преподавателей.\n    ")])],1):e._e()])},a=[],i={data(){return{notificationsPos:"top",prefs:[],disciplines:[],sync_error:!1,platforms:[{label:"Zoom",value:"ZOOM"},{label:"Jitsi",value:"JITSI"},{label:"Google Meet",value:"GOOGLE_MEET"},{label:"Microsoft Teams",value:"MS_TEAMS"}]}},beforeMount(){this.notificationsPos=this.$q.platform.is.mobile?"bottom":"top",this.$q.sessionStorage.getItem("is_student")||(this.$q.loading.show({delay:400,message:"Синхронизация расписания...."}),this.syncAndGetUserPreferences(),this.$q.loading.show({delay:400,message:"Загрузка..."}),this.$q.loading.hide())},methods:{getUserPreferences(){const e="/epi/api/v1/users/preferences";this.$axios.get(e,{withCredentials:!0}).then((e=>{this.prefs=e.data,this.disciplines=this.prefs.disciplines}),(e=>{console.error(e)}))},syncAndGetUserPreferences(e=!1){const s="/epi/api/v1/users/preferences/sync";this.$axios.post(s,{},{params:{force:e},withCredentials:!0}).then((e=>{this.sync_error=!(!e.data||"CACHED"===e.data.status||"SYNCED"===e.data.status)})).catch((e=>{e.response?(console.log(e.response.data),console.log(e.response.status),console.log(e.response.headers)):e.request?console.log(e.request):console.log("Error",e.message),this.sync_error=!0,this.$q.notify({position:this.notificationsPos,icon:"warning",type:"negative",message:"Не удалось синхронизировать настройки!"})})).then((()=>{this.getUserPreferences()}))},sendUpdatedPreferences(){const e="/epi/api/v1/users/preferences";this.$axios.put(e,this.prefs,{withCredentials:!0}).then((e=>{this.$q.notify({position:this.notificationsPos,message:"Предпочтения сохранены",icon:"check"})})).catch((e=>{e.response?(console.log(e.response.data),console.log(e.response.status),console.log(e.response.headers)):e.request?console.log(e.request):console.log("Error",e.message),this.$q.notify({position:this.notificationsPos,icon:"warning",type:"negative",multiLine:!0,message:"Не удалось сохранить предпочтения. Перезагрузите страницу или попробуйте позже."})}))}}},n=i,r=t("2877"),l=t("9989"),c=t("f09f"),d=t("a370"),p=t("ddd8"),f=t("4b7e"),m=t("9c40"),u=t("eb85"),h=t("54e1"),g=t("0016"),_=t("0378"),q=t("05c0"),v=t("eebe"),y=t.n(v),b=Object(r["a"])(n,o,a,!1,null,null,null);s["default"]=b.exports;y()(b,"components",{QPage:l["a"],QCard:c["a"],QCardSection:d["a"],QSelect:p["a"],QCardActions:f["a"],QBtn:m["a"],QSeparator:u["a"],QBanner:h["a"],QIcon:g["a"],QForm:_["a"],QTooltip:q["a"]})}}]);